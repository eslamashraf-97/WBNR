{"version":3,"file":"cart-4419ece4.js","sources":["../../../../components/cart/Aside.vue","../../../../assets/images/delete-icon.svg","../../../../pages/cart.vue"],"sourcesContent":["<script setup>\r\ndefineProps([\"details\"]);\r\n\r\nconst cartDetails = [\r\n  {\r\n    title: \"عدد المنتجات في العربة:\",\r\n    key: \"itemsInCart\",\r\n  },\r\n  {\r\n    title: \"اجمالي سعر البيع:\",\r\n    key: \"final_price\",\r\n    coins: \"ج.م\",\r\n  },\r\n  {\r\n    title: \"اجمالي الربح:\",\r\n    key: \"price\",\r\n    coins: \"ج.م\",\r\n  },\r\n  {\r\n    title: \"الضريبة:\",\r\n    key: \"tax_percentage\",\r\n    coins: \"ج.م\",\r\n  },\r\n  {\r\n    title: \"الربح بعد الضريبة:\",\r\n    key: \"tax_amount\",\r\n    coins: \"ج.م\",\r\n  },\r\n];\r\n</script>\r\n\r\n<template>\r\n  <aside\r\n    class=\"flex flex-col gap-7 2xl:w-[29.25rem] p-9 bg-white border border-gray-200 rounded-3xl dashboard-aside h-fit shadow-main\"\r\n  >\r\n    <template v-if=\"details\">\r\n      <!-- start main info  -->\r\n      <div\r\n        class=\"flex items-center justify-between\"\r\n        v-for=\"(item, index) in cartDetails\"\r\n        :key=\"index\"\r\n      >\r\n        <h5 class=\"text-2xl text-gray-700 font-normal\">{{ item.title }}</h5>\r\n        <h5 class=\"text-2xl text-gray-500 font-normal\">\r\n          <span>{{ details[item.key] }} {{ item.coins }}</span>\r\n        </h5>\r\n      </div>\r\n    </template>\r\n\r\n    <div class=\"mt-9\">\r\n      <shared-buttons-primary-button\r\n        submit-title=\"اطلب الان\"\r\n        class=\"w-[14.5rem] h-[4.1875rem]\"\r\n        @click=\"navigateTo(`/checkout?cart=${details.id}`)\"\r\n      />\r\n    </div>\r\n  </aside>\r\n</template>\r\n\r\n<style scoped></style>\r\n","export default \"__VITE_ASSET__3f132e4e__\"","<script setup>\r\nimport {\r\n  apiGetCartUrl,\r\n  apiGetCartLengthUrl,\r\n  apiDeleteCartItem,\r\n  apiAddToCartUrl,\r\n  apiDeleteCartUrl,\r\n} from \"@/server\";\r\n\r\nconst { selectedCountry } = useCountries();\r\n\r\nconst { setCartLength, cartLength } = useCartLength();\r\n\r\nconst {\r\n  data: cartData,\r\n  refresh,\r\n  pending,\r\n} = await useRequest({\r\n  url: () => apiGetCartUrl,\r\n  requetOptions: {\r\n    query: { country_id: selectedCountry.value?.id },\r\n  },\r\n});\r\n\r\nconst { data: cartDataLength, refresh: cartDataLengthRefresh } =\r\n  await useRequest({\r\n    url: () => apiGetCartLengthUrl,\r\n    requetOptions: {\r\n      query: { country_id: selectedCountry.value?.id },\r\n      onResponse: (response) => {\r\n        setCartLength(response.response?._data?.data.cart_length);\r\n      },\r\n    },\r\n  });\r\n\r\nconst { fire } = useApi({\r\n  url: apiAddToCartUrl,\r\n  requestOptions: {\r\n    method: \"post\",\r\n    onResponse: (response) => {\r\n      if (response.response.ok) {\r\n        refresh();\r\n        cartDataLengthRefresh();\r\n      }\r\n    },\r\n  },\r\n});\r\n\r\nconst updateCartPending = ref(false);\r\n\r\nasync function updateCart(data) {\r\n  updateCartPending.value = true;\r\n  await fire(data);\r\n  updateCartPending.value = false;\r\n}\r\n\r\nfunction increaseQuantity(data) {\r\n  const payload = {\r\n    product_id: data.product.id,\r\n    quantity: data.quantity + 1,\r\n    final_price: data.price,\r\n  };\r\n  updateCart(payload);\r\n}\r\n\r\nfunction decreaseQuantity(data) {\r\n  if (data.quantity > 1) {\r\n    const payload = {\r\n      product_id: data.product.id,\r\n      quantity: data.quantity - 1,\r\n      final_price: data.price,\r\n    };\r\n    updateCart(payload);\r\n  }\r\n}\r\n\r\nlet timer;\r\n\r\nfunction changeQuantity(qty, data) {\r\n  clearTimeout(timer);\r\n  timer = setTimeout(() => {\r\n    if (qty >= 1) {\r\n      const payload = {\r\n        product_id: data.product.id,\r\n        quantity: qty,\r\n        final_price: data.price,\r\n      };\r\n      updateCart(payload);\r\n    }\r\n  }, 300);\r\n}\r\n\r\nfunction changePrice(price, data) {\r\n  clearTimeout(timer);\r\n  timer = setTimeout(() => {\r\n    if (price) {\r\n      const payload = {\r\n        product_id: data.product.id,\r\n        quantity: data.quantity,\r\n        final_price: price,\r\n      };\r\n      updateCart(payload);\r\n    }\r\n  }, 300);\r\n}\r\n\r\nconst isLoading = ref(false);\r\n\r\nasync function deleteCartItem(id) {\r\n  isLoading.value = true;\r\n  await useRequest({\r\n    url: apiDeleteCartItem + \"/\" + id,\r\n    requetOptions: {\r\n      method: \"delete\",\r\n      onResponse: () => {\r\n        refresh();\r\n      },\r\n    },\r\n  });\r\n  isLoading.value = false;\r\n}\r\n\r\nconst clearCartIsPending = ref(false);\r\n\r\nconst { fire: clearCartFire } = useApi({\r\n  url: apiDeleteCartUrl + \"/\" + cartData.value.data.id,\r\n  requestOptions: {\r\n    method: \"delete\",\r\n    onResponse: (response) => {\r\n      console.log(response);\r\n      if (response.response.ok) {\r\n        refresh();\r\n        cartDataLengthRefresh();\r\n      }\r\n    },\r\n  },\r\n});\r\n\r\nasync function clearCart() {\r\n  clearCartIsPending.value = true;\r\n  await clearCartFire();\r\n  clearCartIsPending.value = false;\r\n}\r\n</script>\r\n\r\n<template>\r\n  <section class=\"bg-primary\">\r\n    <shared-title title=\"العربة\" />\r\n    <div\r\n      v-if=\"pending || updateCartPending\"\r\n      class=\"flex items-center justify-center\"\r\n    >\r\n      <shared-loders-loading />\r\n    </div>\r\n    <div class=\"flex flex-col 2xl:flex-row justify-start gap-24\" v-else>\r\n      <cart-aside\r\n        :details=\"{\r\n          ...cartData.data,\r\n          itemsInCart: cartDataLength.data.cart_length || cartLength,\r\n        }\"\r\n      />\r\n      <div class=\"w-full\">\r\n        <cart-products\r\n          :products=\"cartData.data.cartItems\"\r\n          @decreaseQuantity=\"decreaseQuantity\"\r\n          @increaseQuantity=\"increaseQuantity\"\r\n          @deleteCartItem=\"deleteCartItem\"\r\n          @changeQuantity=\"changeQuantity\"\r\n          @changePrice=\"changePrice\"\r\n          @clearCart=\"clearCart\"\r\n          :clearCartIsPending=\"clearCartIsPending\"\r\n        />\r\n      </div>\r\n    </div>\r\n  </section>\r\n</template>\r\n"],"names":["_withAsyncContext","_a"],"mappings":"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"}